<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Codebase Digest</title>
    
    <link rel="stylesheet" href="./styles.css">
</head>
<body>
    <!-- Inline SVG sprite for icons -->
    <svg aria-hidden="true" class="visually-hidden-sprite">
        <symbol id="icon-refresh" viewBox="0 0 24 24">
            <path fill="currentColor" d="M17.65 6.35A7.95 7.95 0 0 0 12 4V1l-4 4 4 4V5c2.76 0 5.26 1.12 7.07 2.93L20 11h3V8l-5.35-1.65zM6.35 17.65A7.95 7.95 0 0 0 12 20v3l4-4-4-4v3c-2.76 0-5.26-1.12-7.07-2.93L4 13H1v3l5.35 1.65z"/>
        </symbol>
        <symbol id="icon-close" viewBox="0 0 24 24">
            <path fill="currentColor" d="M18.3 5.71L12 12l6.3 6.29-1.41 1.42L10.59 13.41 4.29 19.71 2.88 18.3 9.18 12 2.88 5.71 4.29 4.29 10.59 10.59 16.88 4.29z"/>
        </symbol>
        <symbol id="icon-chevron-up" viewBox="0 0 24 24">
            <path fill="currentColor" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"/>
        </symbol>
        <symbol id="icon-chevron-down" viewBox="0 0 24 24">
            <path fill="currentColor" d="M7.41 8.59L12 13.17l4.59-4.58L18 10l-6 6-6-6z"/>
        </symbol>
        <symbol id="icon-folder" viewBox="0 0 24 24">
            <path fill="currentColor" d="M10 4H4a2 2 0 0 0-2 2v2h20V8a2 2 0 0 0-2-2h-8l-2-2zM2 10v8a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-8H2z"/>
        </symbol>
        <symbol id="icon-virtual" viewBox="0 0 24 24">
            <path fill="currentColor" d="M12 2L2 7v6c0 5 4 9 10 9s10-4 10-9V7l-10-5zM12 13a3 3 0 1 1 0-6 3 3 0 0 1 0 6z"/>
        </symbol>
        <symbol id="icon-check" viewBox="0 0 24 24">
            <path fill="currentColor" d="M9 16.2L4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4z"/>
        </symbol>
    </svg>
    <div id="dashboard">
        <!-- Header strip: workspace slug + primary action -->
        <div id="header-strip" class="elevated">
            <div id="workspace-info">
                <h1>Codebase Digest</h1>
                <div id="workspace-slug" aria-live="polite">&nbsp;</div>
            </div>
            <div class="header-actions">
                <!-- One-click transient override: disable redaction for this run only -->
                <button id="btn-disable-redaction" type="button" title="Disable redaction for this run" aria-label="Disable redaction for this run" class="secondary" aria-pressed="false">
                    <span class="label">No Redact (one-shot)</span>
                </button>
                <!-- Preset menu trigger -->
                <button id="preset-btn" type="button" title="Presets" aria-label="Open presets menu" aria-haspopup="true" aria-expanded="false" class="secondary">
                    <span class="label">Presets</span>
                </button>
                <!-- Cancel write button (hidden by default; shown during long writes) -->
                <button id="btn-cancel-write" type="button" title="Cancel write" aria-label="Cancel write" class="secondary" hidden aria-hidden="true">
                    <span class="label">Cancel write</span>
                </button>
            </div>
        </div>
    <!-- Compact status chips: selected / total / size / tokens / over-limit -->
    <div id="status-chips" class="chip-row" aria-live="polite" aria-atomic="true"></div>

        <!-- Preset menu (popup) -->
        <div id="preset-menu" role="menu" aria-hidden="true" hidden>
            <button role="menuitem" data-preset="codeOnly" data-selected="false" id="preset-codeOnly" type="button">Code only</button>
            <button role="menuitem" data-preset="docsOnly" data-selected="false" id="preset-docsOnly" type="button">Docs only</button>
            <button role="menuitem" data-preset="testsOnly" data-selected="false" id="preset-testsOnly" type="button">Tests only</button>
        </div>
        <!-- Progress bar + inline stats + toast container -->
        <div class="progress-wrapper" aria-hidden="false">
                <div id="progress-container" aria-hidden="false">
                <div id="progress-bar" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-label="operation progress"></div>
            </div>
            <div class="progress-stats" aria-live="polite" aria-atomic="true">&nbsp;</div>
        </div>
        <div id="toast-root" aria-live="polite" aria-atomic="true"></div>
    <div id="toolbar">
            <div class="segmented" role="toolbar" aria-label="Digest toolbar">
                <button id="btn-refresh" type="button" data-action="refresh" title="Refresh" aria-label="Refresh">
                    <svg class="icon" aria-hidden="true"><use href="#icon-refresh"></use></svg>
                    <span class="label">Refresh</span>
                </button>
                <button id="btn-select-all" type="button" data-action="selectAll" title="Select all" aria-label="Select all">
                    <svg class="icon" aria-hidden="true"><use href="#icon-check"></use></svg>
                    <span class="label">Select</span>
                </button>
                <button id="btn-clear-selection" type="button" data-action="clearSelection" title="Clear selection" aria-label="Clear selection">
                    <svg class="icon" aria-hidden="true"><use href="#icon-close"></use></svg>
                    <span class="label">Clear</span>
                </button>
                <button id="btn-expand-all" type="button" data-action="expandAll" title="Expand all" aria-label="Expand all">
                    <svg class="icon" aria-hidden="true"><use href="#icon-chevron-up"></use></svg>
                    <span class="label">Expand</span>
                </button>
                <button id="btn-collapse-all" type="button" data-action="collapseAll" title="Collapse all" aria-label="Collapse all">
                    <svg class="icon" aria-hidden="true"><use href="#icon-chevron-down"></use></svg>
                    <span class="label">Collapse</span>
                </button>
                <button type="button" data-action="generateDigest" title="Generate digest" aria-label="Generate digest">
                    <svg class="icon" aria-hidden="true"><use href="#icon-virtual"></use></svg>
                    <span class="label">Generate</span>
                </button>
                <button id="btn-token-count" type="button" data-action="tokenCount" title="Estimate tokens" aria-label="Estimate tokens">
                    <svg class="icon" aria-hidden="true"><use href="#icon-check"></use></svg>
                    <span class="label">Tokens</span>
                </button>
                <!-- Quick preset actions -->
                <button id="btn-preset-code" type="button" data-action="applyPreset" data-preset="codeOnly" data-selected="false" title="Code only" aria-label="Code only">
                    <span class="label">Code</span>
                </button>
                <button id="btn-preset-docs" type="button" data-action="applyPreset" data-preset="docsOnly" data-selected="false" title="Docs only" aria-label="Docs only">
                    <span class="label">Docs</span>
                </button>
                <button id="btn-preset-tests" type="button" data-action="applyPreset" data-preset="testsOnly" data-selected="false" title="Tests only" aria-label="Tests only">
                    <span class="label">Tests</span>
                </button>
                <button id="openSettings" type="button" data-action="openSettings" title="Open settings" aria-label="Open settings">
                    <span class="label">Settings</span>
                </button>
                <button id="btn-pause-resume" type="button" data-action="togglePause" title="Pause/Resume" aria-label="Pause or resume">
                    <span class="label">Pause</span>
                </button>
                <button id="btn-ingest-remote" type="button" data-action="ingestRemote" title="Ingest remote repository" aria-label="Ingest remote">
                    <span class="label">Ingest</span>
                </button>
            </div>
        </div>
    <div id="stats"></div>
    <div id="ascii-tree"></div>
    <div id="file-list"></div>
    <!-- Ingest Remote Modal -->
    <div id="ingestModal" class="modal" hidden>
        <div class="modal-content">
            <h3>Ingest Remote Repository</h3>
            <label>Repo URL or slug: <input id="ingest-repo" type="text" placeholder="owner/repo or https://github.com/owner/repo" /></label>
            <label>Ref (branch/tag/commit): <input id="ingest-ref" type="text" placeholder="branch or tag or commit (optional)" /></label>
            <label>Subpath (optional): <input id="ingest-subpath" type="text" placeholder="src/app/" /></label>
            <label><input id="ingest-submodules" type="checkbox" /> Include submodules</label>
            <div>
                <button id="ingest-submit">Start Ingest</button>
                <button id="ingest-cancel">Cancel</button>
            </div>
            <div id="ingest-preview">
                <div class="spinner" id="ingest-spinner" aria-hidden="true" hidden></div>
                <pre class="ingest-text" id="ingest-preview-text" aria-live="polite"></pre>
            </div>
        </div>
    </div>
            <div id="settings" hidden>
                <h3>Codebase Digest Settings</h3>
                <form id="settingsForm">
                    <label><input type="checkbox" name="gitignore" /> Respect .gitignore</label>
                    <div>
                        <label>Output format
                            <select name="outputFormat">
                                <option value="text">Text</option>
                                <option value="json">JSON</option>
                            </select>
                        </label>
                    </div>
                    <div>
                        <label>Token model
                            <select name="tokenModel">
                                <option value="chars-approx">chars-approx</option>
                                <option value="gpt-4o">gpt-4o</option>
                                <option value="gpt-3.5">gpt-3.5</option>
                            </select>
                        </label>
                    </div>
                    <div>
                        <label>Binary policy
                            <select name="binaryPolicy">
                                <option value="skip">Skip</option>
                                <option value="include">Include</option>
                            </select>
                        </label>
                    </div>
                    <div>
                        <fieldset class="limit-group">
                            <legend>Limits</legend>
                            <div class="limit-row">
                                <label for="maxFilesRange">Max files
                                    <input id="maxFilesRange" type="range" min="100" max="50000" step="100" />
                                </label>
                                <input id="maxFilesNumber" type="number" name="thresholds.maxFiles" aria-label="Max files" />
                                <span class="hint" title="Maximum number of files that will be scanned. Higher values increase memory and processing time.">?</span>
                            </div>
                            <div class="limit-row">
                                <label for="maxTotalSizeRange">Max total size (MB)
                                    <input id="maxTotalSizeRange" type="range" min="1" max="4096" step="1" />
                                </label>
                                <input id="maxTotalSizeNumber" type="number" name="thresholds.maxTotalSizeBytes" aria-label="Max total size (bytes)" />
                                <span class="hint" title="Total bytes across selected files before scanning stops. Measured in MB here for slider ergonomics.">?</span>
                            </div>
                            <div class="limit-row">
                                <label for="tokenLimitRange">Token limit
                                    <input id="tokenLimitRange" type="range" min="256" max="200000" step="256" />
                                </label>
                                <input id="tokenLimitNumber" type="number" name="thresholds.tokenLimit" aria-label="Token limit" />
                                <span class="hint" title="Estimated token budget for output. Larger values increase cost and response size; adjust based on your model and quota.">?</span>
                            </div>
                        </fieldset>
                    </div>
                    
                        <div>
                            <fieldset class="safety-group">
                                <legend>Safety / Redaction</legend>
                                <label><input type="checkbox" name="showRedacted" /> Show redacted (disable masking)</label>
                                <label>Redaction patterns (one per line or comma-separated)
                                    <textarea name="redactionPatterns" rows="4" placeholder="e.g. /SECRET_[A-Z]+/g, PASSWORD=\\S+"></textarea>
                                </label>
                                <label>Redaction placeholder
                                    <input type="text" name="redactionPlaceholder" />
                                </label>
                            </fieldset>
                        </div>

                        <div>
                            <label>Presets (comma-separated)
                                <input type="text" name="presets" />
                            </label>
                        </div>
                    <div>
                        <button id="saveSettings" type="button">Save</button>
                        <button id="cancelSettings" type="button">Cancel</button>
                    </div>
                </form>
            </div>
    <div id="chart-container"></div>
    </div>
    <script src="./main.js"></script>
</body>
</html>
